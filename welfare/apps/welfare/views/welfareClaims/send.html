<div class="page-content">
    <!-- Page Breadcrumb -->
    <div class="page-breadcrumbs">
        <ul class="breadcrumb">
            <li>
                <i class="fa fa-home"></i>
                <a href="#">Home</a>
            </li>
            <li class="active">Dashboard</li>
        </ul>
    </div>
    <!-- /Page Breadcrumb -->
    <!-- Page Header -->
    <div class="page-header position-relative">
        <div class="header-title">
            <h1>
                Dashboard
            </h1>
        </div>
        <!--Header Buttons-->

        <!--Header Buttons End-->
    </div>
    <!-- /Page Header -->

    <!-- Page Body -->
    <div class="page-body">
        <div class="row">
            <div class="col-lg-12 col-sm-12 col-xs-12">
                <div class="widget radius-bordered">
                    <div class="widget-header">
                        <span class="widget-caption">รายการขอรับสวัสดิการ</span>
                    </div>
                    <div class="widget-body">
                        <form id="registrationForm" method="post" class="form-horizontal"
                              data-bv-message="This value is not valid"
                              data-bv-feedbackicons-valid="glyphicon glyphicon-ok"
                              data-bv-feedbackicons-invalid="glyphicon glyphicon-remove"
                              data-bv-feedbackicons-validating="glyphicon glyphicon-refresh">
                            <div class="form-title">
                                รายการขอรับสวัสดิการ
                            </div>

                            <!--<div class="form-group ">-->
                            <!--<label class="col-lg-4 control-label">ประเภทผู้ใช้งาน</label>-->
                            <!--<div class="col-lg-6">-->
                            <!--<input type="text" class="form-control" name="firstName" placeholder="กรอกชื่อ"-->
                            <!--data-bv-notempty="true"-->
                            <!--data-bv-notempty-message="กรุณาระบุประเภทผู้ใช้งาน" />-->
                            <!--</div>-->

                            <!--</div>-->


                            <!--<div class="form-group ">-->
                            <!--<label class="col-lg-4 control-label">ประเภทผู้ใช้งาน</label>-->
                            <!--<div class="col-lg-6">-->
                            <!--<a href="#"><span class="label label-success label-welfare-approve">รับสวัสดิการ</span></a>-->
                            <!--</div>-->

                            <!--</div>-->



                            <!--<div class="form-group ">-->

                            <!--<label class="col-lg-4 control-label">เปิด / ปิด การใช้งาน</label>-->
                            <!--<div class="col-lg-6">-->
                            <!--<div >-->
                            <!--<select class="form-control" name="country" data-bv-field="country">-->
                            <!--<option value="">กรุณาระบุเปิด / ปิด การใช้งาน</option>-->
                            <!--<option value="FR">เปิด</option>-->
                            <!--<option value="DE">ปิด</option>-->


                            <!--</select><i class="form-control-feedback" data-bv-field="country" style="display: none;"></i>-->
                            <!--</div>-->
                            <!--</div>-->

                            <!--</div>-->


                            <!--<div class="form-group ">-->
                            <!--<div class="col-lg-12">-->
                            <!--<div class="col-lg-7 control-label">-->
                            <!--<button id="bn" name="bn" class="btn btn-primary" type="button">บันทึกข้อมูล</button>-->
                            <!--<input type="reset" id="bnreset" name="bnreset" value="ล้างข้อมูล" class="btn">-->
                            <!--</div>-->
                            <!--</div>-->
                            <!--</div>-->










                        </form>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-lg-9 col-md-9 col-sm-12 col-xs-12">
                <div class="row">

                </div>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">

            </div>
        </div>

        <div class="row">



        </div>
    </div>
    <!-- /Page Body -->
</div>
<!-- /Page Content -->
<!-- /Page Content -->


<script type="text/javascript">
    $(function(){

        var data = {};
        //data['registerId'] = "{{registerId}}";
        data['registerId'] = localStorage['registerId'];

        var arr = [],k = 0;

        $.ajax({
            url: '/sdg/api/ManagementWelfare/welfareclaims/list/add',
            data: jsonEncode(data),
            type: 'post', // 'or get'
            async: true,
            success: function (result) {


                for(var i = 0; i < result.listWelfare.length ; i++){
                    var data = result.listWelfare[i],curr = true;


                    for(var j = 0; j < arr.length ; j++){
                        var group = arr[j];
                        if(group.id == data.welfareId){
                            curr = false;
//                            if(group.amount != data.amount){
//                                curr = true;
//                            }
                        }
                    }//check group

                    if(curr){
                        var curUsed = false,curTarget = false;

                        for(var j = 0; j < result.listWelfare.length ; j++){
                            var used = result.listWelfare[j];
                            if(data.welfareId == used.welfareId){
                                if(data.isUsed != 0){
                                    curUsed = true;
                                }
                            }
                        }//check used


                        for(var j = 0; j < result.listWelfare.length ; j++){
                            var target = result.listWelfare[j];
                            if(data.welfareId == target.welfareId){
                                if(data.isUsed != 0){
                                    curUsed = true;
                                }
                                if(data.isTarget != 0){
                                    curTarget = true;
                                }
                            }
                        }//check target

                        arr[k] = {
                            id : data.welfareId,
                            sub : data.welfareSubId,
                            name :data.welfareName,
                            amount : data.amount,
                            target : curTarget,
                            used : curUsed,
                            status : data.statusId
                        };
                        k++;
                    }

                }


                var $html = '';
                for(var i = 0; i < arr.length ; i++){
                    var data = arr[i];

                    if(data.status == 0){

                        if(data.target == true){

                            $html += '<div class="form-group ">'+
                            '<label class="col-lg-3 control-label"><a href="#">'+data.name+'</a></label>'+
                            '<div class="col-lg-3"> <label class="control-label"> จำนวนเงิน : '+data.amount+'</label></div>'+
                            '<div class="col-lg-3">'+
                            '<a href="#"><span class="label label-success label-welfare-approve" data-value="'+data.sub+'">รับสวัสดิการ</span></a>'+
                            '</div>'+
                            '</div>';
                        }

                    }else if(data.status == 1){

                        $html += '<div class="form-group ">'+
                        '<label class="col-lg-3 control-label"><a href="#">'+data.name+'</a></label>'+
                        '<div class="col-lg-3"> <label class="control-label"> จำนวนเงิน : '+data.amount+'</label></div>'+
                        '<div class="col-lg-3">'+
                        '<a href="#"><span class="label label-warning label-welfare-used" data-value="'+data.sub+'">รอการพิจารณา !</span></a>'+
                        '</div>'+
                        '</div>';

                    }



                }
                $("#registrationForm").append($html);

            }
        });



        $(document).on('click','a span.label-welfare-approve',function(e){
            e.preventDefault();
            var $this = $(this);


            var data = {};
            //data['registerId'] = "{{registerId}}";
            data['registerId'] = localStorage['registerId'];
            data['welfareId'] = $this.attr('data-value');


            $.ajax({
                url: '/sdg/api/ManagementWelfare/welfareclaims/add',
                data: jsonEncode(data),
                type: 'post', // 'or get'
                async: true,
                success: function (result) {

                $this.removeClass('label-success');
                $this.removeClass('label-welfare-approve');
                $this.addClass('label-welfare-used');
                $this.addClass('label-warning');
                $this.html('รอการพิจารณา !');



                }
            });


        });




    });
</script>